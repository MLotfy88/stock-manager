# السياق النشط (Active Context)

## التركيز الحالي
التركيز الحالي هو على **الانتهاء من بناء الواجهات الأمامية (UI) للميزات المتقدمة** وتجهيز المشروع بالكامل لمرحلة الربط مع قاعدة البيانات. تم إعادة هيكلة بنية البيانات الأساسية وإضافة واجهات لمعظم الوظائف الرئيسية المطلوبة.

## التغييرات الأخيرة
1.  **إعادة هيكلة جذرية للبيانات:** تم فصل مفهوم "تعريف المنتج" عن "عنصر المخزون" في `src/types/index.ts`، مما أدى إلى إنشاء نماذج `ProductDefinition` و `InventoryItem`.
2.  **تطوير واجهة تعريف المنتجات:** تم تحويل صفحة `SupplyTypesPage` بالكامل لتصبح واجهة متقدمة لتعريف المنتجات ومتغيراتها (المقاسات/الكيرفات)، مع إضافة حقل "حد الطلب" لكل متغير.
3.  **تطوير واجهة إضافة المخزون:** تم تحديث صفحة `AddSupplyPage` لتعتمد على المنتجات المعرفة مسبقاً.
4.  **إضافة ميزة المخازن المتعددة:**
    *   تم إنشاء نموذج بيانات `Store`.
    *   تم إنشاء صفحة `StoresPage` لإدارة المخازن.
    *   تم إضافة حقل لاختيار المخزن في صفحة إضافة المخزون.
5.  **إضافة ميزة نقل المخزون:** تم إنشاء صفحة `TransferInventoryPage` جديدة بالكامل لنقل الأصناف بين المخازن.
6.  **تطبيق ميزة مسح الباركود:** تم دمج ماسح الباركود في صفحات "إضافة المخزون"، "صرف المستلزمات"، و "نقل المخزون" لتسريع إدخال البيانات.
7.  **بناء واجهات التقارير الجديدة:**
    *   تم إنشاء صفحة `InventoryReportPage` لجرد المخزون.
    *   تم إنشاء صفحة `ReorderPointReportPage` لعرض الأصناف التي وصلت لحد الطلب.
8.  **تفعيل ميزة الاستيراد والتصدير:** تم إضافة منطق فعلي لاستيراد وتصدير "تعريف المنتجات" كملفات CSV مباشرة من صفحتها الخاصة، مع إزالة الواجهة القديمة من صفحة الإعدادات.

## القرارات والاعتبارات
- **العمل بالبيانات المؤقتة (Mock Data):** تم بناء جميع الواجهات الجديدة باستخدام بيانات مؤقتة لتسريع عملية التطوير. الخطوة التالية الحاسمة هي استبدال هذه البيانات باتصالات حقيقية مع قاعدة بيانات Supabase.
- **منطق الباركود (تم التصحيح):** تم إعادة هيكلة منطق الباركود ليرتبط بكل دفعة توريد (`InventoryItem`) كمعرّف فريد لها، بدلاً من ربطه بتعريف المنتج.
- **إعادة هيكلة واجهة الإدارة:** تم إلغاء قسم "الإدارة" من القائمة الجانبية ودمج جميع صفحاته (تعريف المنتجات، الشركات المصنعة، الموردين، المخازن) داخل تبويبات في صفحة "الإعدادات" الرئيسية (`AdminPage`).
- **إصلاح مشكلة البناء:** تم حل مشكلة تعارض في بيئة النشر بسبب ملف `bun.lockb`. تم حذف الملف والاعتماد على `npm` بشكل كامل، مما يضمن استقرار عملية البناء.
- **إعادة هيكلة الإعدادات:** تم فصل إعدادات Supabase وبيانات الدخول إلى صفحة "إدارة" جديدة (`/management`) لتحسين تنظيم الكود.
- **إصلاحات واجهة المستخدم:** تم إصلاح زر القائمة الجانبية في وضع الموبايل وتحسين استجابة بعض المكونات.
- **إعادة تصميم إضافة المخزون:** تم تحويل صفحة إضافة المخزون بالكامل إلى واجهة "فاتورة مشتريات" متعددة الأصناف، مع ربط الباركود بالدفعة بدلاً من تعريف المنتج.
- **إعادة هيكلة صفحة الإعدادات:** تم إصلاح صفحة إعدادات البيانات (`AdminPage`) بالكامل. تم تحويل جميع التبويبات الفرعية (المخازن، الشركات المصنعة، الموردين، تعريف المنتجات) إلى مكونات محتوى مستقلة، مما حل مشكلة الصفحة البيضاء والتعارض الهيكلي. تم أيضًا تحسين استجابة الصفحة بالكامل للشاشات الصغيرة.
- **تحسين ماسح الباركود:** تم تحسين أداء ماسح الباركود بشكل كبير من خلال تفعيل ميزة التركيز التلقائي (`auto-focus`) وتحسين دقة القراءة.
- **مراجعة شاملة للاستجابة:** تم فحص جميع صفحات التطبيق والتأكد من توافقها الكامل مع شاشات الموبايل، مع تطبيق إصلاحات على الجداول والنماذج المعقدة.
- **إضافة إدارة أنواع المستلزمات:** تم إنشاء واجهة جديدة لإدارة أنواع المستلزمات وحل مشكلة القائمة الفارغة في صفحة تعريف المنتجات.
- **إصلاح صفحة نقل المخزون:** تم حل مشكلة الشاشة البيضاء وربط الصفحة بالبيانات الحية.

## الخطوات التالية
1.  **الربط الكامل بـ Supabase (الأولوية القصوى):** تعديل جميع الصفحات والعمليات (`src/data/operations`) لاستخدام دوال Supabase لجلب وتحديث البيانات الحقيقية.
2.  **بناء واجهة تقارير موحدة:** إعادة تصميم صفحة التقارير لتجميع كل التقارير (جرد، حد الطلب، استهلاك) في واجهة واحدة مع تبويبات.
3.  **تطوير واجهة إضافة مخزون مجمّع:** إنشاء واجهة جديدة تسمح بإضافة عدة أصناف مخزون دفعة واحدة.
4.  **بناء نظام المصادقة (Authentication):** إضافة نظام تسجيل دخول باستخدام Supabase Auth.
